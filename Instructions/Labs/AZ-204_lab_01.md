---
lab:
  az204Title: 'Lab 01: Build a web application on Azure platform as a service offerings'
  az020Title: 'Lab 01: Build a web application on Azure platform as a service offerings'
  az204Module: 'Module 01: Create Azure App Service Web Apps'
  az020Module: 'Module 01: Create Azure App Service Web Apps'
---

# <a name="lab-01-build-a-web-application-on-azure-platform-as-a-service-offering"></a>实验室 01：在 Azure 平台即服务产品/服务上构建 Web 应用程序

## <a name="microsoft-azure-user-interface"></a>Microsoft Azure 用户接口

鉴于 Microsoft 云工具的动态特性，Azure UI 在此培训内容开发后可能会发生更改。 因此，实验说明和实验步骤可能无法正确对应。

我们发现社区进行了必要更改时，Microsoft 会更新此培训课程。 但是，云更新经常发生，因此在此培训内容更新之前，可能会发生 UI 更改。 如果发生这种情况，请适应这些更改，并根据需要在实验室中熟悉这些更改。

## <a name="instructions"></a>说明

### <a name="before-you-start"></a>开始之前

#### <a name="sign-in-to-the-lab-environment"></a>登录到实验室环境

使用以下凭据登录到 Windows 10 虚拟机 (VM)：

- 用户名：Admin

- 密码：Pa55w.rd

> **注意**：你的讲师将提供连接到虚拟实验室环境的说明。

#### <a name="review-the-installed-applications"></a>查看已安装的应用程序
在你的 Windows 10 桌面上找到任务栏。 任务栏里有本实验室中你将使用的应用程序的图标，包括：

- Microsoft Edge
- 文件资源浏览器
- Windows 终端
- Visual Studio Code

## <a name="architecture-diagram"></a>体系结构关系图

![描述用户在 Azure 平台即服务产品/服务上构建 Web 应用程序的体系结构关系图。](./media/Lab01-Diagram.png)

### <a name="exercise-1-build-a-backend-api-by-using-azure-storage-and-the-web-apps-feature-of-azure-app-service"></a>练习 1：通过使用 Azure 存储和 Azure 应用服务的 Web 应用功能来生成后端 API

#### <a name="task-1-open-the-azure-portal"></a>任务 1：打开 Azure 门户

1. 在任务栏上，选择 Microsoft Edge 图标。

1. 在浏览器窗口中，浏览到 Azure 门户 (<https://portal.azure.com>)，然后使用你将用于此实验室的帐户登录。

   > **注意**：第一次登录 Azure 门户时，你会看到一个门户教程。 如果想跳过该导览，请选择“以后再说”以开始使用门户。

#### <a name="task-2-create-a-storage-account"></a>任务 2：创建存储帐户

1. 在 Azure 门户中，使用“搜索资源、服务和文档”文本框搜索“存储帐户”，然后在结果列表中选择“存储帐户”  。

1. 在“存储帐户”边栏选项卡上，选择“+ 创建”。 ****  

1. 在“创建存储帐户”边栏选项卡的“基本信息”选项卡上，执行以下操作，然后选择“查看”： ****   

    | 设置 | 操作 |
    | -- | -- |
    | “订阅”下拉列表 | 保留默认值 |
    | “资源组”部分 | 选择“新建”，输入“ManagedPlatform”，然后选择“确定”   |
    | “存储帐户名称”文本框  | 输入“imgstor[yourname]” | 
    | “区域”下拉列表 | 选择“(US)美国东部” |
    | “性能”部分 | 选择“标准”选项 |
    | “冗余”下拉列表 | 选择“本地冗余存储(LRS)” |

    以下屏幕截图显示了“创建存储帐户”边栏选项卡的“基本信息”选项卡上配置的设置 。

    ![“创建存储帐户”边栏选项卡](./media/l01_create_a_storage_account.png)

1. 在“查看”选项卡中，查看在上述步骤中选择的选项。

1. 选择“创建”，使用指定的配置创建存储帐户。

    > **注意**：等待创建任务完成，再继续操作本实验室。

1. 在“概述”边栏选项卡上，选择“转到资源”按钮以导航到新创建的存储帐户的边栏选项卡 。

1. 在“存储帐户”边栏选项卡上的“安全 + 网络”部分中，选择“访问密钥”。 ****   ****  

1. 在“访问密钥”边栏选项卡上，选择“显示密钥”。 ****  

1. 查看任一密钥，然后将任一“连接字符串”框的值复制到剪贴板。 ****  

    > **注意**：你选择哪个连接字符串无关紧要。 它们是可互换的。

1. 打开记事本，然后将复制的连接字符串值粘贴到记事本。 你稍后将在本实验室中使用此值。

#### <a name="task-3-upload-a-sample-blob"></a>任务 3：上传样本 blob

1. 在“存储帐户”边栏选项卡上的“数据存储”部分中，选择“容器”链接  。

1. 在“容器”边栏选项卡中，选择“+ 容器” 。

1. 在“新建容器”窗口中，执行以下操作：

    | 设置  | 操作 |
    | -- | -- |
    | “名称”文本框 | 输入“images” |
    | “公共访问级别”列 | 选择“Blob (仅限 Blob 的匿名读取访问)”，然后选择“创建”  |

1. 在“容器”边栏选项卡中，选择新创建的“images”容器 。

1. 在“images”边栏选项卡中，选择“上传” 。

1. 在“上传 Blob”窗口中，执行以下操作：

    | 设置 | 操作 |
    | -- | -- |
    | “文件”部分 | 选择“文件夹”图标 |
    | “文件资源管理器”窗口 | 浏览到 Allfiles (F):\\Allfiles\\Labs\\01\\Starter\\Images，选择 grilledcheese.jpg 文件，然后选择“打开”   |
    | “如果文件已存在，请覆盖”复选框 | 确保选中该复选框，然后选择“上传” |

    > **注意**：等待 Blob 上传完成，然后再继续本实验室。

#### <a name="task-4-create-a-web-app"></a>任务 4：创建 Web 应用

1. 在 Azure 门户的导航窗格上，选择“创建资源”。

1. 在“创建资源”窗格的“搜索服务和市场”文本框中，输入“Web 应用”  ，然后按 Enter 键。

1. 在“市场”搜索结果边栏选项卡中，选择“Web 应用”结果 。

1. 在 “Web 应用”边栏选项卡，选择“创建”********。

1. 在“创建 Web 应用”边栏选项卡的“基本”选项卡上，执行以下操作，然后选择“监视”选项卡：  

    | 设置 | 操作 |
    | -- | -- |
    | “订阅”下拉列表 | 保留默认值 |
    | “资源组”部分 | 选择“ManagedPlatform” |
    | “名称”文本框  | 输入“imgapi[yourname]” |
    | “发布”部分 | 选择“代码” |
    | “运行时堆栈”下拉列表 | 选择“.NET 6 (LTS)” |
    | “操作系统”部分 | 选择“Windows” |
    | “区域”下拉列表 | 选择“美国东部”区域 |
    | “Windows 计划(美国东部)”部分 | 选择“新建”，在“名称”文本框中输入值“ManagedPlan”，然后选择“确定”    |
    | “SKU 和大小”部分 | 保留默认值 |

    以下屏幕截图显示了“创建 Web 应用”窗格上配置的设置。

    ![创建 Web 应用边栏选项卡](./media/l01_create_a_web_app.png)

1. 在“监视”选项卡的“启用 Application Insights”部分中，选择“否”，然后选择“查看 + 创建”   。

1. 在“查看 + 创建”选项卡中，查看在上述步骤中选择的选项。

1. 选择“创建”，使用指定的配置创建 Web 应用。 

   > **注意**：等待 Web 应用创建完成，再继续本实验室。

1. 在“概述”边栏选项卡上，选择“转到资源”按钮以导航到新创建的 Web 应用的边栏选项卡。 

#### <a name="task-5-configure-the-web-app"></a>任务 5：配置 Web 应用

1. 在“应用服务”边栏选项卡的“设置”部分，选择“配置”链接  。

1. 在“配置”部分中，执行以下操作，选择“保存”，然后选择“继续”  。

    | 设置 | 操作 |
    | -- | -- |
    | “应用程序设置”选项卡 | 选择“新应用程序设置” |
    | “添加/编辑应用程序设置”弹出对话框 | 在“名称”文本框中，输入“StorageConnectionString”  |
    | “值”文本框 | 粘贴先前复制到记事本的存储连接字符串 |
    | “部署槽位设置”文本框 | 保存默认值，然后选择“确定”关闭弹出对话框，并返回到“配置”部分  |

    等待应用程序设置保存后再继续本实验室。

1. 在“应用服务”边栏选项卡的“设置”部分，选择“属性”链接  。

1. 在“属性”部分，复制 URL 超链接的值，然后将其粘贴到记事本 。 你将在稍后的实验室中使用此值。

    > **注意**：此时，此 URL 的 Web 服务器将返回占位符网页。 你尚未向 Web 应用中部署任何代码。 你将在本实验室稍后部分向 Web 应用部署代码。

#### <a name="task-6-deploy-an-aspnet-web-application-to-web-apps"></a>任务 6：将 `ASP.NET` Web 应用程序部署到 Web 应用

1. 在任务栏上，选择“Visual Studio Code”图标。

1. 在“文件”**** 菜单中，选择“打开文件夹”****。

1. 在“文件资源管理器”窗口中，浏览到 Allfiles (F):\\Allfiles\\Labs\\01\\Starter\\API，然后选择“选择文件夹”  。

    > 注意：忽略任何提示，无论是添加生成和调试所需资产的提示，还是运行还原命令来解决未解析的依赖项的提示。

1. 在“Visual Studio Code”窗口的“资源管理器”窗格中，展开 Controllers 文件夹，然后选择 ImagesController.cs 文件以在编辑器中打开。 ****   **** 

1. 在编辑器中 ImagesController 类的第 26 行，观察 GetCloudBlobContainer 方法和用于检索容器的代码 。

1. 在 ImagesController 类的第 36 行，观察 Get 方法和用于从 images 容器异步检索所有 blob 的代码  。

1. 在 ImagesController 类的第 55 行，观察 Post 方法和用于将上传图像保存到 Azure 存储的代码 。

1. 在任务栏上，选择“Windows 终端”图标。

1. 在打开的命令提示符处，输入以下命令并按 Enter 键以登录 Azure 命令行接口 (CLI)：

    ```
    az login
    ```

1. 在 Microsoft Edge 浏览器窗口中，输入 Microsoft 帐户的电子邮件地址和密码，然后选择“登录” 。

1. 返回当前打开的 Windows 终端“命令提示符”窗口。 请等待登录过程完成。

1. 在命令提示符处，输入以下命令并按 Enter，列出 ManagedPlatform 资源组中的所有应用：

    ```
    az webapp list --resource-group ManagedPlatform
    ```

1. 输入以下命令，然后按 Enter 查找具有前缀 imgapi\* 的应用：

    ```
    az webapp list --resource-group ManagedPlatform --query "[?starts_with(name, 'imgapi')]"
    ```

1. 输入以下命令，然后按 Enter 以仅呈现具有前缀 imgapi\* 的单一应用的名称：

    ```
    az webapp list --resource-group ManagedPlatform --query "[?starts_with(name, 'imgapi')].{Name:name}" --output tsv
    ```

1. 输入以下命令，然后按 Enter，将当前目录更改为包含实验室文件的 Allfiles (F):\\Allfiles\\Labs\\01\\Starter\\API 目录：

    ```
    cd F:\Allfiles\Labs\01\Starter\API\
    ```

1. 输入以下命令然后按 Enter，以将 api.zip 文件部署到之前在此实验室中创建的 Web 应用：

    ```
    az webapp deployment source config-zip --resource-group ManagedPlatform --src api.zip --name <name-of-your-api-app>
    ```

    > **注意**：将 *\<name-of-your-api-app\>* 占位符替换为之前在本练习中创建的 Web 应用的名称。 你最近在之前的步骤中查询了此应用的名称。

    等待部署完成后，再继续本实验室。

1. 在 Azure 门户的“导航”窗格中，选择“资源组”链接。

1. 在“资源组”边栏选项卡中，选择你之前在本实验室中创建的 ManagedPlatform 资源组 。

1. 在“ManagedPlatform”边栏选项卡上，选择你先前在本实验室中创建的 imgapi[yourname] Web 应用。 

1. 在“应用服务”边栏选项卡中，选择“浏览” 。

    > **注意**：“浏览”命令将向网站的根执行 GET 请求，该请求返回一个 JavaScript 对象表示法 (JSON) 数组。 此数组应包含你在 Azure 存储帐户中上传的单个映像的 URL。

1. 返回到包含 Azure 门户的浏览器窗口。

1. 关闭当前正在运行的 Visual Studio Code 和“Windows 终端”应用程序。

#### <a name="review"></a>审阅

在本练习中，你在 Azure 中创建了一个 Web 应用，然后使用 Azure CLI 和 Apache Kudu zip 文件部署实用程序将 `ASP.NET` Web 应用程序部署到了 Web 应用。

### <a name="exercise-2-build-a-front-end-web-application-by-using-azure-web-apps"></a>练习 2：使用 Azure Web 应用构建前端 Web 应用程序

#### <a name="task-1-create-a-web-app"></a>任务 1：创建 Web 应用

1. 在 Azure 门户的导航窗格上，选择“创建资源” 。

1. 在“创建资源”窗格的“搜索服务和市场”文本框中，输入“Web 应用”  ，然后按 Enter 键。

1. 在“市场”搜索结果边栏选项卡中，选择“Web 应用” 。

1. 在 “Web 应用”边栏选项卡，选择“创建”********。

1. 在“创建 Web 应用”边栏选项卡的“基本”选项卡上，执行以下操作，然后选择“监视”选项卡：  

   | 设置 | 操作 |
   | -- | -- |
   | “订阅”下拉列表 | 保留默认值 |
   | “资源组”部分 | 选择“ManagedPlatform” |
   | “名称”文本框  | 输入“imgweb[yourname]” |
   | “发布”部分 | 选择“代码” |
   | “运行时堆栈”下拉列表 | 选择“.NET 6 (LTS)” |
   | “操作系统”部分 | 选择“Windows” |
   | “区域”下拉列表 | 选择“美国东部”区域 |
   | “Windows 计划(美国东部)”部分 | 选择“ManagedPlan (S1)” |

以下屏幕截图显示了“创建 Web 应用”窗格上配置的设置。

   ![创建 Web 应用边栏选项卡](./media/l01_create_a_front_end_web_app.png)

1. 在“监视”选项卡的“启用 Application Insights”部分中，选择“否”，然后选择“查看 + 创建”   。

1. 在“查看 + 创建”选项卡中，查看在先前步骤中选择的选项。

1. 选择“创建”，使用指定的配置创建 Web 应用。 

   > **注意**：等待创建任务完成，再继续操作本实验室。

1. 在“概述”边栏选项卡上，选择“转到资源”按钮以导航到新创建的 Web 应用的边栏选项卡。 

#### <a name="task-2-configure-a-web-app"></a>任务 2：配置 Web 应用

1. 在“应用服务”边栏选项卡的“设置”部分，选择“配置”链接  。

1. 在“配置”部分中，执行以下操作，选择“保存”，然后选择“继续”  ：

    | 设置 | 操作 |
    | -- | -- |
    | “应用程序设置”选项卡 | 选择“新应用程序设置” |
    | “添加/编辑应用程序设置”弹出对话框 | 在“名称”文本框中，输入“ApiUrl”  |
    | “值”文本框 | 输入之前在此实验室中复制的 Web 应用 URL。 注意：请确保在复制到此应用程序设置的“值”文本框的 URL 中包含协议 https:// |
    | “部署槽位设置”文本框 | 保留默认值，然后选择“确定” |

    > **注意**：等待应用程序设置保存后再继续本实验室。

#### <a name="task-3-deploy-an-aspnet-web-application-to-web-apps"></a>任务 3：将 `ASP.NET` Web 应用程序部署到 Web 应用

1. 在任务栏上，选择“Visual Studio Code”图标。

1. 在“文件”**** 菜单中，选择“打开文件夹”****。

1. 在“文件资源管理器”窗口中，浏览到 Allfiles (F):\\Allfiles\\Labs\\01\\Starter\\Web，然后选择“选择文件夹”  。

    > 注意：忽略任何提示，无论是添加生成和调试所需资产的提示，还是运行还原命令来解决未解析的依赖项的提示。

1. 在“Visual Studio Code”窗口的“资源管理器”窗格中，展开 Pages 文件夹，然后选择 Index.cshtml.cs 文件以在编辑器中打开。 ****   **** 

1. 在编辑器的 IndexModel 类的第 30 行，观察 OnGetAsync 方法和用于从 API 检索映像列表的代码 。

1. 在 IndexModel 类的第 41 行，观察 OnPostAsync 方法和用于将上传图像流式传输到后端 API 的代码 。

1. 在任务栏上，选择“Windows 终端”图标。

1. 在打开的命令提示符处，输入以下命令并按 Enter 键以登录 Azure CLI：

    ```
    az login
    ```

1. 在 Microsoft Edge 浏览器窗口中，输入 Microsoft 帐户的电子邮件地址和密码，然后选择“登录” 。

1. 返回当前打开的 Windows 终端“命令提示符”窗口。 请等待登录过程完成。

1. 输入以下命令并按 Enter 键以列出 ManagedPlatform 资源组中的所有应用：

    ```
    az webapp list --resource-group ManagedPlatform
    ```

1. 输入以下命令，然后按 Enter 查找具有前缀 imgweb\* 的应用：

    ```
    az webapp list --resource-group ManagedPlatform --query "[?starts_with(name, 'imgweb')]"
    ```

1. 输入以下命令，然后按 Enter 以仅呈现具有前缀 imgweb\* 的单一应用的名称：

    ```
    az webapp list --resource-group ManagedPlatform --query "[?starts_with(name, 'imgweb')].{Name:name}" --output tsv
    ```

1. 输入以下命令，然后按 Enter，将当前目录更改为包含实验室文件的 Allfiles (F):\\Allfiles\\Labs\\01\\Starter\\Web 目录：

    ```
    cd F:\Allfiles\Labs\01\Starter\Web\
    ```

1. 输入以下命令然后按 Enter，以将 web.zip 文件部署到之前在此实验室中创建的 Web 应用：

    ```
    az webapp deployment source config-zip --resource-group ManagedPlatform --src web.zip --name <name-of-your-web-app>
    ```

    > **注意**：将 *\<name-of-your-web-app\>* 占位符替换为之前在本练习中创建的 Web 应用的名称。 你最近在之前的步骤中查询了此应用的名称。

    等待部署完成后，再继续本实验室。

1. 在 Azure 门户的导航窗格中，选择“资源组” 。

1. 在“资源组”边栏选项卡中，选择你之前在本实验室中创建的 ManagedPlatform 资源组 。

1. 在“ManagedPlatform”边栏选项卡上，选择你先前在本实验室中创建的 imgweb[yourname] Web 应用 。

1. 在“应用服务”边栏选项卡中，选择“浏览”。

1. 查看图库中的图像列表。 图库应列出之前在实验室中上传到存储的单个图像。

1. 在“Contoso Photo Gallery”网页的“上传新图像”部分中，执行以下操作 ：

    a.  选择“浏览”。

    b.  在“文件资源管理器”窗口中，浏览至 Allfiles (F):\\Allfiles\\Labs\\01\\Starter\\Images 文件，然后选择“打开”   。

    c.  选择“上传”。 

1. 观察已用新图像更新的图库图像。

    > **注意**：在极少数情况下，你可能需要刷新浏览器窗口才能检索新图像。

1. 返回到包含 Azure 门户的浏览器窗口。

1. 关闭当前正在运行的 Visual Studio Code 和“Windows 终端”应用程序。

#### <a name="review"></a>审阅

在本练习中，你创建了一个 Azure Web 应用，并将现有 Web 应用程序代码部署到云中的资源。

### <a name="exercise-3-clean-up-your-subscription"></a>练习 3：清理订阅

#### <a name="task-1-open-azure-cloud-shell"></a>任务 1：打开 Azure Cloud Shell

1. 在 Azure 门户中，选择“Cloud Shell”图标 ![Cloud Shell 图标](./media/az204_lab_CloudShell.png) 以打开一个新的 Bash 会话。 如果 Cloud Shell 默认为 PowerShell 会话，请选择“PowerShell”，然后在下拉菜单中选择“Bash”。

    > **注意**：如果这是你第一次启动 Cloud Shell，当系统提示你选择“Bash”或“PowerShell”时，请选择“PowerShell”。 当出现消息“未安装存储”时，请选择你在本实验中使用的订阅，然后选择“创建存储”。 

#### <a name="task-2-delete-resource-groups"></a>任务 2：删除资源组

1. 在 Cloud Shell 窗格中，运行以下命令以删除“ManagedPlatform”资源组： 

    ```
    az group delete --name ManagedPlatform --no-wait --yes
    ```

     > **注意**：该命令异步执行（由 --no-wait 参数确定）。 虽然可以在命令执行后立即运行另一个 Azure CLI 命令，但在同一 Bash 会话中，实际删除资源组需要几分钟时间。

1. 关闭门户中的“Cloud Shell”窗格。

#### <a name="task-3-close-the-active-applications"></a>任务 3：关闭活动应用程序

- 关闭当前正在运行的 Microsoft Edge 应用程序。

#### <a name="review"></a>审阅

在本练习中，你通过删除本实验室中使用的资源组清理了订阅。
