---
lab:
    az204Title: '实验室 01：在 Azure 平台即服务 (PaaS) 产品上构建 Web 应用程序'
    az020Title: '实验室 01：在 Azure 平台即服务 (PaaS) 产品上构建 Web 应用程序'
    az204Module: '模块 01：创建 Azure 应用服务 Web 应用'
    az020Module: '模块 01：创建 Azure 应用服务 Web 应用'
---

# 实验室 01：在 Azure 平台即服务 (PaaS) 产品上构建 Web 应用程序

## Microsoft Azure 用户界面

鉴于 Microsoft 云工具的动态特性，Azure UI 在此培训内容开发后可能会发生更改。这些更改可能会导致实验室说明和实验室步骤不匹配。

当社区要求我们进行更改时，Microsoft 将更新此培训课程。但是，由于云更新频繁发生，因此在此培训内容更新之前，你可能会遇到 UI 更改情况。**如果发生这种情况，请适应这些更改，并根据需要在实验室中熟悉这些更改。**

## 说明

### 准备工作

#### 登录到实验室虚拟机

使用以下凭据登录到 Windows 10 虚拟机 (VM)：
    
-   用户名：**Admin**
    
-   密码： **Pa55w.rd**

> **备注**： 你的讲师将提供连接到虚拟实验室环境的说明。

#### 查看已安装的应用程序

在你的 Windows 10 桌面上找到任务栏。任务栏里有本实验室中你将使用的应用程序的图标：
    
-   Microsoft Edge

-   文件资源管理器

-   Windows PowerShell

-   Visual Studio Code

### 练习 1：通过使用 Azure 存储和 Azure 应用服务的 Web 应用功能来生成后端 API

#### 任务 1：打开 Azure 门户

1.  在任务栏上，选择 **“Microsoft Edge”** 图标。

1.  在打开的浏览器窗口中，转到 Azure 门户 (<https://portal.azure.com>)。

1.  在登录页面，输入 Microsoft 帐户的电子邮件地址，然后选择 **“下一步”**。

1.  输入你的 Microsoft 帐户的密码，然后选择 **“登录”**。

    > **备注**： 如果首次登录到 Azure 门户，则对话框会提供门户教程。选择 **“开始使用”**，以跳过导览并开始使用门户。

#### 任务 2：创建存储帐户

1.  在 Azure 门户的“导航”窗格中，选择 **“所有服务”**。

1.  在 **“所有服务”** 边栏选项卡中，选择 **“存储帐户”**。

1.  在 **“存储帐户”** 边栏选项卡中，获得存储账户实例列表。

1.  在“**存储帐户**”边栏选项卡中，选择“**+ 创建**”。

1.  在 **“创建存储帐户”** 边栏选项卡中，观察边栏选项卡中的选项卡，例如 **“基本”**、 **“标记”** 和 **“查看 + 创建”**。

    > **备注**： 每个选项卡代表工作流中创建新存储帐户的一个步骤。可以随时选择 **“查看 + 创建”** 跳过剩余选项卡。

1.  选择 **“基本”** 选项卡，然后在选项卡区域内执行以下操作：
    
    1.  将 **“订阅”** 文本框保留设置为默认值。
    
    1.  在 **“资源组”** 部分，选择 **“新建”**，输入**ManagedPlatform**，然后选择 **“确定”**。
    
    1.  在 **“存储帐户名称”** 文本框中，输入 **imgstor*[yourname]***。
    
    1.  在“**区域**”列表中，选择“**(美国)美国东部**”区域。
    
    1.  在 **“性能”** 部分，选择 **“标准”**。
    
    1.  在 **“冗余”** 列表中，选择 **“本地冗余存储(LRS)”**。
    
    1.  选择 **“查看 + 创建”**。

1.  在 **“查看 + 创建”** 选项卡中，查看在前面步骤中指定的选项。

1.  选择 **“创建”**，使用指定的配置创建存储帐户。

1.  在**部署**边栏选项卡中，等待创建任务完成后再继续本实验室内容。

1.	选择 **“部署”** 边栏选项卡中的 **“前往资源”** 按钮，以转到新创建的存储帐户。

1.	在 **“存储账户”** 边栏选项卡中，找到 **“安全性 + 网络”** 部分，然后选择 **“访问密钥”**。

1.	从“**访问密钥**”边栏选项卡中，选择“**显示密钥**”。

1.  选择任一密钥，然后记录任一“**连接字符串**”框的值。你稍后将在本实验室中使用此值。

    > **备注**： 你选择哪个连接字符串无关紧要。它们可以互换。

#### 任务 3：上传示例 blob

1.  在 Azure 门户的导航窗格中，选择 **“资源组”**。

1.  在 **“资源组”** 边栏选项卡中，选择你之前在本实验室中创建的 **“ManagedPlatform”** 资源组。

1.  在 **“ManagedPlatform”** 边栏选项卡中，选择你之前在本实验室中创建的 **imgstor*[yourname]*** 存储帐户。

1.  在 **“存储帐户”** 边栏选项卡中，在 **“数据存储”** 部分，选择 **“容器”** 链接。

1.  在 **“容器”** 部分，选择 **“+ 容器”**。

1.  在 **“新建容器”** 窗口中，执行以下操作：
    
    1.  在 **“名称”** 文本框中，输入 **“images”**。
    
    1.  从 **“公共访问级别”** 列表中，选择 **“Blob (仅限 Blob 的匿名读取访问)”**，然后选择 **“创建”**。

1.  在 **“容器”** 部分，选择新创建的 **“images”** 容器。

1.	在 **“容器”** 边栏选项卡中，选择 **“上传”**。

1.	在 **“上传 Blob”** 窗口中，执行以下操作：

    1.  在 **“文件”** 部分，选择 **“文件夹”** 图标。

    1.  在 **“文件资源管理器”** 窗口中，浏览 **Allfiles (F):\\Allfiles\\Labs\\01\\Starter\\Images**，选择 **grilledcheese.jpg** 文件，然后选择 **“打开”**。

    1.  确保选中 **“如果文件存储已经存在，则覆盖”** 复选框，然后选择 **“上传”**。等待 blob 上传完成，然后再继续本实验室。

#### 任务 4：创建 Web 应用

1.  在 Azure 门户的导航窗格上，选择 **“创建资源”**。

1.  在 **“创建资源”** 边栏选项卡上，找到 **“搜索服务和市场”** 文本框。

1.  在搜索框中，输入 **“Web 应用”**，然后按 Enter。

1.  在 **“市场”** 搜索结果边栏选项卡中，选择 **“Web 应用”** 结果。

1.  在 **“Web 应用”** 边栏选项卡中，选择 **“创建”**。

1.  在 **“创建 Web 应用”** 边栏选项卡中，找到边栏选项卡中的选项卡，例如 **“基本信息”**。

    > **备注**： 每个选项卡都代表在工作流中新建 Web 应用的一个步骤。你可以随时选择 **“查看 + 创建”** 跳过其余选项卡。

1.  在 **“基本信息”** 选项卡中，执行以下操作：
    
    1.  将 **“订阅”** 文本框保留设置为默认值。
    
    1.  在 **“资源组”** 下拉列表中，选择 **“ManagedPlatform”**。
    
    1.  在 **“名称”** 文本框中，输入**imgapi*[yourname]***。

    1.  在 **“发布”** 部分，选择 **“代码”**。

    1.  在 **“运行时堆栈”** 下拉列表中，选择 **“.NET Core 3.1 (LTS)”**。

    1.  在 **“操作系统”** 部分，选择 **“Windows”**。

    1.  在 **“区域”** 下拉列表中，选择 **“美国东部”** 区域。

    1.  在 **“Windows 计划(美国东部)”** 部分中，选择 **“新建”**，然后将值 **“ManagedPlan”** 输入 **“名称”** 文本框中，接着选择 **“确定”**。

    1.  将 **“SKU 和大小”** 部分保留设置为默认值。

    1.  选择 **“下一步: 部署(预览)”**。

1.  在 **“部署(预览)”** 选项卡中，执行以下操作：

    1.  选择 **“下一步: 监视”**。

1.  在**监视**选项卡中，执行以下操作：

    1.  在 **“启用 Application Insights”** 部分，选择 **“否”**。

    1.  选择 **“查看 + 创建”**。

1.  在 **“查看 + 创建”** 选项卡中，查看在先前步骤中选择的选项。

1.  选择 **“创建”**，使用指定的配置创建 Web 应用。等待创建任务完成，再继续本实验室。

#### 任务 5：配置 Web 应用

1.  在 Azure 门户的导航窗格中，选择 **“资源组”**。

1.  在 **“资源组”** 边栏选项卡中，选择你之前在本实验室中创建的  **“ManagedPlatform”** 资源组。

1.  在 **“ManagedPlatform”** 边栏选项卡中，选择你先前在本实验室中创建的 “**imgapi*[yourname]***” Web 应用。

    > **备注**：如果未列出 **imgapi*[yourname]*** Web 应用，请选择“**显示隐藏类型**”以显示它。

1.  在 **“应用服务”** 边栏选项卡的 **“设置”** 部分，选择 **“配置”** 链接。

1.  在 **“配置”** 部分，执行以下操作：
    
    1.  选择 **“应用程序设置”** 选项卡，然后选择 **“新应用程序设置”**。
    
    1.  在出现的 **“添加/编辑应用程序设置”** 弹窗中，在 **“名称”** 文本框中，输入 **“StorageConnectionString”**。
    
    1.  在 **“值”** 文本框中，输入之前在本实验室中记录的存储连接字符串。
    
    1.  将 **“部署槽设置”** 文本框保留为其默认值，然后选择 **“确定”** 关闭弹出的对话框并返回 **“配置”** 部分。
    
    1.  从边栏选项卡中选择“**保存**”以保留设置，然后选择“**继续**”。
  
    等待应用程序设置保存后再继续本实验室。

1.  在 **“应用服务”** 边栏选项卡的 **“设置”** 部分，选择 **“属性”** 链接。

1.  在 **“属性”** 部分，复制 **“URL”** 超链接的值。你将在稍后的实验室中使用此值。

    > **备注**： 此时，此 URL 的 Web 服务器将返回占位符网页。你尚未向 Web 应用中部署任何代码。你将在本实验室稍后部分向 Web 应用部署代码。

#### 任务 6：将 ASP.NET Web 应用程序部署到 Web 应用

1.  在任务栏上，选择 **“Visual Studio Code”** 图标。

1.  在 **“文件”** 菜单上，选择 **“打开文件夹”**。

1.  在**文件资源管理器**窗口，转到 **“Allfiles (F):\\Allfiles\\Labs\\01\\Starter\\API”**，然后选择 **“选择文件夹”**。

1.  在资源管理器 **Visual Studio Code** 窗口，展开 **Controllers** 文件夹,，然后选择 **ImagesController.cs** 文件以在编辑器中打开。

1.  在编辑器中 **ImagesController** 类的第 26 行，观察 **GetCloudBlobContainer** 方法和用于检索容器的代码。

1.  在 **ImagesController** 类的第 36 行，观察 **Get** 方法和用于从 **images** 容器异步检索所有 blob 的代码。

1.  在 **ImagesController** 类的第 55 行，观察 **Post** 方法和用于将上传图像保存到 Azure 存储的代码。

1.  在任务栏上，选择 **Windows Terminal** 图标。

1.  在打开的命令提示符中，输入以下命令并按 Enter 键以登录 Azure 命令行接口 (CLI)：

    ```
    az login
    ```

1.	在 **Microsoft Edge** 浏览器窗口中，执行以下操作：
    
    1.  输入你的 Microsoft 帐户的电子邮件地址，然后选择 **“下一个”**。
    
    1.  输入你的 Microsoft 帐户的密码，然后选择 **“登录”**。

1.	返回当前打开的 **“Command Prompt”** 窗口。等待登录过程完成。

1.	在命令提示符处，输入以下命令，然后按 Enter 键列出 **“ManagedPlatform”** 资源组中的所有应用：

    ```
    az webapp list --resource-group ManagedPlatform
    ```

1.	输入以下命令，然后按 Enter 键查找具有前缀 **imgapi\*** 的应用：

    ```
    az webapp list --resource-group ManagedPlatform --query "[?starts_with(name, 'imgapi')]"
    ```

1.	输入以下命令，然后按 Enter 键以仅呈现具有前缀 **imgapi\*** 的单一应用的名称：

    ```
    az webapp list --resource-group ManagedPlatform --query "[?starts_with(name, 'imgapi')].{Name:name}" --output tsv
    ```

1.	输入以下命令，然后按 Enter 键将当前目录更改为包含实验室文件的 **Allfiles (F):\\Allfiles\\Labs\\01\\Starter\\API** 目录：

    ```
    cd F:\Allfiles\Labs\01\Starter\API\
    ```

1.	输入以下命令然后按 Enter，以将 **api.zip** 文件部署到之前在此实验室中创建的 Web 应用：

    ```
    az webapp deployment source config-zip --resource-group ManagedPlatform --src api.zip --name <name-of-your-api-app>
    ```

    > **备注**： 用你之前在本实验室中创建的 Web 应用名称替换 *\<name-of-your-api-app\>* 占位符。你最近在之前的步骤中查询了此应用的名称。
  
  	等待部署完成后，再继续本实验室。

1.  在 Azure 门户的“导航”窗格中，选择 **“资源组”** 链接。

1.	在 **“资源组”** 边栏选项卡中，找到并选择你之前在本实验室中创建的 **ManagedPlatform** 资源组。

1.	在 **“ManagedPlatform”** 边栏选项卡中，选择你先前在本实验室中创建的 **imgapi*[yourname]*** Web 应用。

1.	在 **“应用服务”** 边栏选项卡中，选择 **“浏览”**。

1.	向网站根目录执行 GET 请求并观察返回的 JavaScript 对象表示法 (JSON) 数组。此数组应包含你在 Azure 存储帐户中上传的单个映像的 URL。

1.	返回 Azure 门户浏览器窗口。

1.  关闭当前正在运行的 Visual Studio Code 和 Windows 终端应用程序。

#### 回顾

在本练习中，你在 Azure 中创建了一个 Web 应用，然后使用 Azure CLI 和 Apache Kudu zip 文件部署实用程序将 ASP.NET Web 应用程序部署到 Web 应用。

### 练习 2：使用 Azure Web 应用构建前端 Web 应用程序

#### 任务 1：创建 Web 应用

1.  在 Azure 门户的导航窗格上，选择 **“创建资源”**。

1.  在 **“创建资源”** 边栏选项卡上，找到 **“搜索服务和市场”** 文本框。

1.  在搜索框中，输入 **“Web 应用”**，然后按 Enter。

1.  在 **“市场”** 搜索结果边栏选项卡中，选择 **“Web 应用”** 结果。

1.  在 **“Web 应用”** 边栏选项卡中，选择 **“创建”**。

1.  在 **“创建 Web 应用”** 边栏选项卡中，找到边栏选项卡中的选项卡，例如 **“基本信息”**。

    > **备注**：每个选项卡都代表在工作流中新建 Web 应用的一个步骤。你可以随时选择 **“查看 + 创建”** 跳过其余选项卡。

1.  在 **“基本信息”** 选项卡中，执行以下操作：
    
    1.  将 **“订阅”** 文本框保留设置为默认值。
    
    1.  在 **“资源组”** 下拉列表中，选择 **“ManagedPlatform”**。
    
    1.  在 **“姓名”** 文本框中，输入**imgweb*[yourname]***。

    1.  在 **“发布”** 部分，选择 **“代码”**。

    1.  在 **“运行时堆栈”** 下拉列表中，选择 **“.NET Core 3.1 (LTS)”**。

    1.  在 **“操作系统”** 部分，选择 **“Windows”**。

    1.  在 **“区域”** 下拉列表中，选择 **“美国东部”** 区域。

    1.  在 **“Windows 计划(美国东部)”** 部分，选择 **“托管计划(S1)”**。

    1.  选择 **“下一步: 部署(预览)”**。

1.  在 **“部署(预览)”** 选项卡中，执行以下操作：

    1.  选择 **“下一步: 监视”**。

1.  在**监视**选项卡中，执行以下操作：

    1.  在 **“启用 Application Insights”** 部分，选择 **“否”**。

    1.  选择 **“查看 + 创建”**。

1.  在 **“查看 + 创建”** 选项卡中，查看在先前步骤中选择的选项。

1.  选择 **“创建”**，使用指定的配置创建 Web 应用。等待创建任务完成，再继续本实验室。

#### 任务 2：配置 Web 应用

1.  在 Azure 门户的导航窗格中，选择 **“资源组”**。

1.  在 **“资源组”** 边栏选项卡中，选择你之前在本实验室中创建的 **“ManagedPlatform”** 资源组。

1.  在 **ManagedPlatform** 边栏选项卡中，选择你之前在本实验室中创建的 **imgweb*[yourname]*** Web 应用。

    > **备注**：如果未列出 **imgapi*[yourname]*** Web 应用，请选择“**显示隐藏类型**”以显示它。

1.  在 **“应用服务”** 边栏选项卡的 **“设置”** 部分，选择 **“配置”** 链接。

1.  在 **“配置”** 部分，执行以下操作：
    
    1.  选择 **“应用程序设置”** 选项卡，然后选择 **“新应用程序设置”**。
    
    1.  在 **“添加/编辑应用程序设置”** 弹出式对话框中，在 **“名称”** 文本框中输入 **“ApiUrl”**。
    
    1.  在 **“值”** 文本框中，输入之前在本实验室中复制的 Web 应用 URL。

        > **备注**： 请确保在复制到此应用程序设置的 **“值”** 文本框的 URL 中包含协议，例如 **https://**。
    
    1.  将 **“部署槽设置”** 文本框保留设置为默认值。

    1.  选择 **“确定”** 关闭弹出窗口，然后返回到 **“配置”** 部分。
    
    1.  从边栏选项卡中选择“**保存**”以保留设置，然后选择“**继续**”。
  
    等待应用程序设置保存后再继续本实验室。

#### 任务 3：将 ASP.NET Web 应用程序部署到 Web 应用

1.  在任务栏上，选择 **“Visual Studio Code”** 图标。

1.  在 **“文件”** 菜单上，选择 **“打开文件夹”**。

1.  在 **“文件资源管理器”** 窗格中，浏览到 **Allfiles (F):\\Allfiles\\Labs\\01\\Starter\\Web** ，然后选择 **“选择文件夹”**。

1.  在 **“Visual Studio Code”** 窗口的资源管理器窗格中，展开 **“Pages”** 文件夹并双击 **“Index.cshtml.cs”** 文件以在编辑器中打开文件。

1.  在编辑器 **IndexModel** 类的第 30 行，观察 **OnGetAsync** 方法和用于从 API 映像列表检索容器的代码。

1.  在 **IndexModel** 类的第 41 行，观察 **OnPostAsync** 方法和用于将上传图像传输到后端 API 的代码。

1.  在任务栏上，选择 **Windows Terminal** 图标。

1.  在打开的命令提示符中，输入以下命令并按 Enter 键以登录 Azure CLI：

    ```
    az login
    ```

1.  在浏览器窗口中，执行以下操作：
    
    1.  输入你的 Microsoft 帐户的电子邮件地址，然后选择 **“下一个”**。
    
    1.  输入你的 Microsoft 帐户的密码，然后选择 **“登录”**。

1.	返回当前打开的 **“Command Prompt”** 窗口。等待登录过程完成。

1.	输入以下命令，然后按 Enter 键列出 **“ManagedPlatform”** 资源组中的所有应用：

    ```
    az webapp list --resource-group ManagedPlatform
    ```

1.	输入以下命令，然后按 Enter 键查找具有前缀 **imgweb\** 的应用：

    ```
    az webapp list --resource-group ManagedPlatform --query "[?starts_with(name, 'imgweb')]"
    ```

1.	输入以下命令，然后按 Enter 键以仅呈现具有前缀 **imgweb\*** 的单一应用的名称：

    ```
    az webapp list --resource-group ManagedPlatform --query "[?starts_with(name, 'imgweb')].{Name:name}" --output tsv
    ```

1.	输入以下命令，然后按 Enter 键将当前目录更改为包含实验室文件的 **Allfiles (F):\\Allfiles\\Labs\\01\\Starter\\Web** 目录：

    ```
    cd F:\Allfiles\Labs\01\Starter\Web\
    ```

1.	输入以下命令，然后按 Enter 键将 **web.zip** 文件部署到之前在本实验室中创建的 Web 应用：

    ```
    az webapp deployment source config-zip --resource-group ManagedPlatform --src web.zip --name <name-of-your-web-app>
    ```

    > **备注**： 用你之前在本实验室中创建的 Web 应用名称替换 *\<name-of-your-web-app\>* 占位符。你最近在之前的步骤中查询了此应用的名称。
  
  	等待部署完成后，再继续本实验室。

1.	在 Azure 门户的“导航”窗格中，选择 **“资源组”**。

1.	在 **“资源组”** 边栏选项卡中，选择你之前在本实验室中创建的 **“ManagedPlatform”** 资源组。

1.	在 **“ManagedPlatform”** 边栏选项卡中，选择你之前在本实验室中创建的 imgweb[yourname] Web 应用。

1.	在 **“应用服务”** 边栏选项卡中，选择 **“浏览”**。

1.	查看图库中的图像列表。图库应列出之前在实验室中上传到存储的单个图像。

1.	在 **“Contoso Photo Gallery”** 网页，找到 **“上传新图像”** 部分并执行以下操作：
    
    1.  选择 **“浏览”**。
    
    1.  在 **“文件资源管理器”** 窗口中，浏览至 **“Allfiles (F):\\Allfiles\\Labs\\01\\Starter\\Images”** ，选择 **“bahnmi.jpg”** 文件，然后选择 **“打开”**。
    
    1.  选择 **“上传”**。

1.	观察已用新图像更新的图库图像。

    > **备注**： 在极少数情况下，你可能需要刷新浏览器窗口才能检索新图像。

1.	返回 Azure 门户浏览器窗口。

1.  关闭当前正在运行的 Visual Studio Code 和 Windows 终端应用程序。

#### 回顾

在本练习中，你创建了一个 Azure Web 应用，并将现有 Web 应用程序代码部署到云中的资源。

### 练习 3：清理订阅 

#### 任务 1：打开 Azure Cloud Shell

1.  在 Azure 门户中，选择 **“Cloud Shell”** 图标以打开一个新的 shell 实例。

    > **备注**： **Cloud Shell** 图标使用大于符号 (\>) 和下划线字符 (\_) 表示。

1.  如果这是你第一次使用订阅打开 Cloud Shell，则可以使用 **“欢迎使用 Azure Cloud Shell 向导”** 来配置 Cloud Shell，以便首次使用。在向导中执行以下操作：
    
    1.  对话框提示你配置 shell。选择 **“Bash”**，查看选定的订阅，然后选择 **“创建存储”**。
    
    1.  等待 Cloud Shell 完成首次设置过程后，再继续本实验室。

    > **备注**：如果 Cloud Shell 配置选项未显示，很可能是因为你使用的是本课程实验室中的现有订阅。实验是假设你使用的是新订阅的情况下编写的。

#### 任务 2：删除资源组

1.  输入以下命令，然后按 Enter 键删除 **“ManagedPlatform”** 资源组：

    ```
    az group delete --name ManagedPlatform --no-wait --yes
    ```

1.  关闭门户中的 Cloud Shell 窗格。

#### 任务 3：关闭活动应用程序

-   关闭当前正在运行的 Microsoft Edge 应用程序。

#### 回顾

在本练习中，你通过删除本实验室中使用的资源组清理订阅。
