---
lab:
  az204Title: 'Lab 04: Construct a polyglot data solution'
  az020Title: 'Lab 04: Construct a polyglot data solution'
  az204Module: 'Module 04: Develop solutions that use Cosmos DB storage'
  az020Module: 'Module 04: Develop solutions that use Cosmos DB storage'
---

# <a name="lab-04-construct-a-polyglot-data-solution"></a>实验室 04：构造多语言数据解决方案

## <a name="microsoft-azure-user-interface"></a>Microsoft Azure 用户接口

Given the dynamic nature of Microsoft cloud tools, you might experience Azure UI changes that occur after the development of this training content. As a result, the lab instructions and lab steps might not align correctly.

Microsoft updates this training course when the community alerts us to needed changes. However, cloud updates occur frequently, so you might encounter UI changes before this training content updates. <bpt id="p1">**</bpt>If this occurs, adapt to the changes, and then work through them in the labs as needed.<ept id="p1">**</ept>

## <a name="instructions"></a>说明

### <a name="before-you-start"></a>开始之前

#### <a name="sign-in-to-the-lab-environment"></a>登录到实验室环境

使用以下凭据登录到 Windows 10 虚拟机 (VM)：
    
-   用户名：Admin

-   密码：Pa55w.rd

> **注意**：你的讲师将提供连接到虚拟实验室环境的说明。

#### <a name="review-the-installed-applications"></a>查看已安装的应用程序

Find the taskbar on your Windows 10 desktop. The taskbar contains the icons for the applications that you'll use in this lab, including:
    
-   Microsoft Edge

-   文件资源浏览器

-   Visual Studio Code

## <a name="architecture-diagram"></a>体系结构关系图

![描述用户通过创建 Azure 存储帐户和 Azure Cosmos DB 帐户构造多语言数据解决方案的体系结构关系图。](./media/Lab04-Diagram.png)

### <a name="exercise-1-creating-data-store-resources-in-azure"></a>练习 1：在 Azure 中创建数据存储资源

#### <a name="task-1-open-the-azure-portal"></a>任务 1：打开 Azure 门户

1.  在任务栏上，选择 Microsoft Edge 图标。

1.  在打开的浏览器窗口中，浏览到 Azure 门户 ([portal.azure.com](https://portal.azure.com))，然后使用你将用于此实验室的帐户登录。

    > 鉴于 Microsoft 云工具的动态特性，Azure UI 在此培训内容开发后可能会发生更改。

#### <a name="task-2-create-an-azure-cosmos-db-account-resource"></a>任务 2：创建 Azure Cosmos DB 帐户资源

1.  在 Azure 门户中，使用“搜索资源、服务和文档”文本框搜索“Azure Cosmos DB”，然后在结果列表中，选择“Azure Cosmos DB”  。

1.  在“Azure Cosmos DB”边栏选项卡上，选择“+ 创建” **** 。

1.  在“选择 API 选项”边栏选项卡上的“核心 (SQL) - 推荐”框中，选择“创建” ****   。

1.  在“创建 Azure Cosmos DB 帐户 - 核心 (SQL)”的“基本信息”选项卡上，执行以下操作，然后选择“查看 + 创建”  ：

    | 设置 | 操作 |
    | -- | -- |
    | 订阅列表 | 保留默认值 |
    | “资源组”部分  | 选择“新建” |
    | “名称”文本框 | 输入“Polyglotdata”，然后选择“确定”  |
    | AccountName 文本框 | 输入“polycosmos[yourname]” |
    | “位置”下拉列表 | 选择与实验室计算机位置最接近的 Azure 区域，并选择要在其中创建 Cosmos DB 帐户的位置 |
    | “容量模式”部分  | 选择“无服务器” |
    
    以下屏幕截图显示了“创建 Azure Cosmos DB 帐户 - 核心 (SQL)”边栏选项卡上配置的设置。
    
    ![显示为创建 Azure Cosmos DB 帐户配置的选项的屏幕截图](media/l04_cosmosdb_create_summary.png)
    
1.  在“创建 Azure Cosmos DB 帐户 - 核心 (SQL)”边栏选项卡上的“查看 + 创建”选项卡上，查看你在前面步骤中选择的选项 。 

1.  选择“创建”，使用指定的配置创建 Azure Cosmos DB 帐户。

    > **注意**：等待创建任务完成，再继续本实验室。

1.  选择“转到资源”。

1.  在“Azure Cosmos DB 帐户”边栏选项卡上，找到“设置”部分，然后选择“密钥”链接 ****   ****  。

1.  因此，实验说明和实验步骤可能无法正确对应。

#### <a name="task-3-create-an-azure-storage-account-resource"></a>任务 3：创建 Azure 存储帐户资源

1.  在 Azure 门户中，使用“搜索资源、服务和文档”文本框搜索“存储帐户”，然后在结果列表中选择“存储帐户”  。

1.  在“存储帐户”边栏选项卡上，选择“+ 创建”。 ****  

1.  在“创建存储帐户”边栏选项卡的“基本信息”选项卡上，执行以下操作，然后选择“查看 + 创建”  ：


    | 设置 | 操作 |
    | -- | -- |
    | 订阅列表 | 保留默认值 |
    | “资源组”部分 | 选择“PolyglotData” |
    | “存储帐户名称”文本框 | 输入“polystor[yourname]” |
    | “地区”下拉列表  | 选择之前在本练习中创建 Cosmos DB 帐户的区域 |
    | “性能”部分  | 选择“标准” |
    | “冗余”下拉列表  | 选择“本地冗余存储(LRS)” |
    
    
    以下屏幕截图显示了“创建存储帐户”边栏选项卡上配置的设置。
          
     ![显示为创建 Azure 存储帐户配置的选项的屏幕截图](media/l04_storage_create_summary.png)
     
1.  在“创建存储帐户”边栏选项卡上的“查看 + 创建”选项卡上，查看你在前面步骤中选择的选项 。

1.  选择“创建”，使用指定的配置创建存储帐户。

    > **注意**：等待创建任务完成，再继续操作本实验室。

#### <a name="review"></a>审阅

In this exercise, you created the Azure resources that you'll need for the polyglot data solution you'll implement in this lab. The Azure resources you created include an Azure Cosmos DB account and an Azure Storage account.

### <a name="exercise-2-review-and-upload-data"></a>练习 2：查看并上传数据

#### <a name="task-1-upload-images-to-azure-blob-storage"></a>任务 1：将图像上传到 Azure Blob 存储

1.  在 Azure 门户导航窗格中，导航回“存储帐户”边栏选项卡，然后选择在此实验室之前的练习中创建的 polystor[yourname] 存储帐户 。

1.  在 polystor[yourname] 存储帐户边栏选项卡中，选择“数据存储”部分的“容器”链接 。

1.  在“容器”部分，选择“+ 容器” 。

1.  在“新建容器”弹出窗口中，执行以下操作，然后选择“创建”： 

    | 设置 | 操作 |
    | -- | -- |
    | “名称”文本框 | 输入“images” |
    | “公共访问级别”下拉列表 | 选择“Blob (仅限 Blob 匿名读取访问)” |
    
   
1.  返回“容器”部分，选择新创建的 images 容器 。

1.  在“容器”边栏选项卡中，找到“设置”部分，然后选择“属性”链接  。

1.  我们发现社区进行了必要更改时，Microsoft 会更新此培训课程。

1.  在边栏选项卡中找到并选择“概述”链接。
1.  在边栏选项卡中，选择“上传”。

1.  在“上传 Blob”弹出窗口中，执行以下操作：
    
    但是，云更新经常发生，因此在此培训内容更新之前，可能会发生 UI 更改。
    
    如果发生这种情况，请适应这些更改，并根据需要在实验室中熟悉这些更改。
    
    c.  Ensure that <bpt id="p1">**</bpt>Overwrite if files already exist<ept id="p1">**</ept> is selected, and then select <bpt id="p2">**</bpt>Upload<ept id="p2">**</ept>.

    > **注意**：等待所有 Blob 上传完成，然后再继续本实验室。

#### <a name="task-2-review-json-data"></a>任务 2：查看 JSON 数据

1.  在实验室计算机上，启动“Visual Studio Code”。

1.  在“文件”菜单中，选择“打开文件”，浏览到 Allfiles (F):\\Allfiles\\Labs\\04\\Starter\\AdventureWorks\\AdventureWorks.Upload，选择“models.json”，然后选择“打开”    。

1.  查看“models.json”文件的格式，并注意它包含 JSON 对象的数组，还包含作为 Products 属性一部分的对象嵌套数组， 。

    > **注意**：这将确定你将定义的类，以便在将 JSON 文件内容上传到 Cosmos DB 集合之前对其内容进行反序列化。

1.  请注意，在“models.json”文件中有一个名为“Category”的属性 。

    > **注意**：你将使用“Category”属性定义目标 Cosmos DB 集合的分区。

1.  关闭 Visual Studio Code。

#### <a name="task-3-create-a-cosmos-db-database-and-collection-and-perform-a-json-data-upload"></a>任务 3：创建 Cosmos DB 数据库和集合，并上传 JSON 数据

1.  在“启动”屏幕上，选择“Visual Studio Code”磁贴 。

1.  在“文件”菜单上，选择“打开文件夹” 。

1.  在打开的“文件资源管理器”窗口中，浏览到 Allfiles (F):\\Allfiles\\Labs\\04\\Starter\\AdventureWorks，然后选择“选择文件夹”  。

1.  在“Visual Studio Code”窗口中的“菜单”栏上，选择“终端”，然后选择“新建终端”  。

1.  在终端中，验证当前目录是否设置为“AdventureWorks”（如果不是，请更改为此目录），然后运行以下命令将终端上下文切换到“AdventureWorks.Upload”文件夹 ：

    ```
    cd .\AdventureWorks.Upload\
    ```

    > **注意**：执行下一步之前，请打开 Windows 资源管理器，并从文件 Allfiles (F):\\Allfiles\\Labs\\04\\Starter\\AdventureWorks\\AdventureWorks.Upload\\AdventureWorks.Upload.csproj 中删除只读属性 

1.  在终端提示符下，运行以下命令，将 Azure Cosmos DB .NET 客户端库添加到当前打开的项目：

    ```
    dotnet add package Microsoft.Azure.Cosmos --version 3.28.0
    ```

    > <bpt id="p1">**</bpt>Note<ept id="p1">**</ept>: The <bpt id="p2">**</bpt>dotnet add package<ept id="p2">**</ept> command will add the <bpt id="p3">**</bpt>Microsoft.Azure.Cosmos<ept id="p3">**</ept> package from <bpt id="p4">**</bpt>NuGet<ept id="p4">**</ept>. For more information, refer to <bpt id="p1">[</bpt>Microsoft.Azure.Cosmos<ept id="p1">](https://www.nuget.org/packages/Microsoft.Azure.Cosmos)</ept>.

1.  Observe the results of the build printed in the terminal. The build should complete successfully with no errors or warning messages.

1.  在“Visual Studio Code”窗口的“资源管理器”窗格中，展开“AdventureWorks.Upload”项目 ****   。

1.  打开 **Program.cs** 文件。

1.  In the <bpt id="p1">**</bpt>Program.cs<ept id="p1">**</ept> file, review the <bpt id="p2">**</bpt>using<ept id="p2">**</ept> directives and note that they include <bpt id="p3">**</bpt>Microsoft.Azure.Cosmos<ept id="p3">**</ept>, <bpt id="p4">**</bpt>System.IO;<ept id="p4">**</ept>, <bpt id="p5">**</bpt>System.Text.Json<ept id="p5">**</ept>, <bpt id="p6">**</bpt>System.Threading.Tasks<ept id="p6">**</ept>, and <bpt id="p7">**</bpt>System.Collections.Generic<ept id="p7">**</ept>. This enables asynchronous upload of JSON items from a local file on your lab computer to a collection in a Cosmos DB database.

1.  In the <bpt id="p1">**</bpt>Program.cs<ept id="p1">**</ept> file, on line 14, set the value of <bpt id="p2">**</bpt>EndpointUrl<ept id="p2">**</ept> by replacing the empty string with the <bpt id="p3">**</bpt>URI<ept id="p3">**</ept> property of the Cosmos DB account that you recorded earlier in this lab. Ensure that the value is enclosed in double quotes.

1.  On line 15, set the value of <bpt id="p1">**</bpt>AuthorizationKey<ept id="p1">**</ept> by replacing the empty string with the <bpt id="p2">**</bpt>PRIMARY KEY<ept id="p2">**</ept> property of the Cosmos DB account that you recorded earlier in this lab. Ensure that the value is enclosed in double quotes.

1.  在第 18 行中，将空字符串替换为“/Category”，以设置“PartitionKey”的值 。

1.  在第 19 行中，将空字符串替换为“F:\\\\Allfiles\\\\Labs\\\\04\\\\Starter\\\\AdventureWorks\\\\AdventureWorks.Upload\\\\models.json”，以设置“JsonFilePath”的值 。

1.  Within the try block, note the invocation of the <bpt id="p1">**</bpt>CreateDatabaseIfNotExistsAsync<ept id="p1">**</ept> method of the <bpt id="p2">**</bpt>CosmosClient<ept id="p2">**</ept> class. This will create a database if one doesn't already exist.

1.  Note the invocation of the <bpt id="p1">**</bpt>DefineContainer<ept id="p1">**</ept> method of the <bpt id="p2">**</bpt>Database<ept id="p2">**</ept> class. This will create a container that will host the JSON items if one doesn't already exist.

    > **注意**：DefineContainer 方法包括一个成本最小化选项，借此你可以修改默认索引策略（自动索引所有属性）。

1.  请注意 using 语句，该语句依赖于 StreamReader 对象，以从文本文件中读取 JSON 项，并将其反序列化到 Program.cs 文件中进一步定义的 Model 类的对象中   。

1.  请注意 foreach 循环，它遍历反序列化对象集合并将每个对象异步地插入到目标集合中。

1.  查看 Model 和 Product 类，这些类反映之前在此实验室中查看的 JSON 格式文件中存储的对象格式 。

1.  保存后关闭 Program.cs 文件。 ****

    > **注意**：如果收到文件为只读的提示，请选择“覆盖”。

1. 在终端中，运行以下命令以还原任何缺失的 NuGet 包，并在文件夹中生成项目：

    ```
    dotnet build
    ```

    > **注意**：dotnet build 命令将在生成文件夹中的所有项目之前自动还原所有丢失的 NuGet 包。

1.  在终端提示符下，运行以下命令以运行 .NET Core 控制台应用程序：

    ```
    dotnet run
    ```

    > <bpt id="p1">**</bpt>Note<ept id="p1">**</ept>: The <bpt id="p2">**</bpt>dotnet run<ept id="p2">**</ept> command will automatically build any changes to the project and then start the web application without a debugger attached. The command will output the messages indicating the data load's progress, including the number of items inserted into the target collection and the duration of the insert operation.

1.  在你的 Windows 10 桌面上找到任务栏。

1.  选择“终止终端”（“回收站”图标）以关闭终端窗格和任何关联的进程 。

#### <a name="task-4-validate-json-data-upload"></a>任务 4：验证 JSON 数据是否上传

1.  在实验室计算机上，切换到显示 Azure 门户的“Microsoft Edge”浏览器窗口。

1. 在 Azure 门户中，选择“搜索资源、服务和文档”文本框，在“最近使用的资源”列表中选择之前在此实验室中创建的 polycosmos[yourname] Azure Cosmos DB 帐户  。

1.  在“Azure Cosmos DB 帐户”边栏选项卡上，查找并选择边栏选项卡上的“数据资源管理器”链接。 ****

1.  在“数据资源管理器”窗格中，展开“零售”数据库节点 。

1.  展开“Online”容器节点，然后选择“新建 SQL 查询” 。

    > 任务栏里有本实验室中你将使用的应用程序的图标，包括：

1.  在“查询”选项卡中，输入以下文本：

    ```sql
    SELECT * FROM models
    ```

1.  选择“执行查询”，然后查看查询返回的 JSON 项列表。

1.  返回查询编辑器，将现有文本替换为以下文本：

    ```sql
    SELECT VALUE COUNT(1) FROM models
    ```

1.  选择“执行查询”，然后查看 COUNT 聚合操作的结果 。

1.  切换回“Visual Studio Code”窗口。

#### <a name="review"></a>审阅

In this exercise, you used the .NET SDK for Azure Cosmos DB to insert data into Azure Cosmos DB. The web application that you implement next will use this data.

### <a name="exercise-3-configure-a-net-web-application"></a>练习 3：配置 .NET Web 应用程序

#### <a name="task-1-update-references-to-data-stores-and-build-the-web-application"></a>任务 1：更新对数据存储的引用并生成 Web 应用程序

1.  在“Visual Studio Code”窗口的“资源管理器”窗格中，展开 AdventureWorks.Web 项目。 ****   

1.  打开 **appsettings.json** 文件。

1.  In the JSON object on line 3, find the <bpt id="p1">**</bpt>ConnectionStrings.AdventureWorksCosmosContext<ept id="p1">**</ept> path. Note that the current value is empty:

    ```json
    "ConnectionStrings": {
        "AdventureWorksCosmosContext": "",
    },
    ```

1.  通过将 AdventureWorksCosmosContext 属性的值设置为你之前在本实验室中记录的 Azure Cosmos DB 帐户的“主连接字符串”来更新该值。 ****   ****

1.  In the JSON object on line 6, find the <bpt id="p1">**</bpt>Settings.BlobContainerUrl<ept id="p1">**</ept> path. Note that the current value is empty:

    ```json
    "Settings": {
        "BlobContainerUrl": "",
        ...
    }
    ```

1.  通过将 BlobContainerUrl 属性的值设置为你之前在本实验室中记录的名为 images 的 Azure 存储 Blob 容器的 URL 属性来更新该属性 ****   **** 。

1.  保存 appsettings.json 文件并将其关闭。 ****  

    > **注意**：如果收到文件为只读的提示，请选择“覆盖”。

1.  在“Visual Studio Code”窗口中，选择“AdventureWorks.Context”，激活快捷菜单，然后选择“在集成终端中打开”  。

    > **注意**：执行下一步之前，请打开 Windows 资源管理器，并从文件 Allfiles (F):\Allfiles\Labs\04\Starter\AdventureWorks\AdventureWorks.Context\AdventureWorks.Context.csproj 中删除只读属性

1.  在终端提示符下，验证当前目录是否设置为“AdventureWorks.Context”（如果不是，将其更改为该目录），然后运行以下命令从 NuGet 导入 Microsoft.Azure.Cosmos ：

    ```
    dotnet add package Microsoft.Azure.Cosmos --version 3.28.0
    ```

1.  在终端提示符下，运行以下命令以生成 .NET Web 应用程序：

    ```
    dotnet build
    ```

1.  Observe the results of the build printed in the terminal. The build should complete successfully with no errors or warning messages.

#### <a name="task-2-configure-connectivity-to-azure-cosmos-db"></a>任务 2：到 Azure Cosmos DB 的配置连接

1.  在“Visual Studio Code”窗口的“资源管理器”窗格中，展开“AdventureWorks.Context”项目。 ****   

1.  从“AdventureWorks.Context”文件夹节点的快捷菜单中，选择“新建文件” 。

1.  在新文件提示符处，输入“AdventureWorksCosmosContext.cs”。

1.  在 AdventureWorksCosmosContext.cs 文件的代码编辑器选项卡中，添加以下代码行，以从引用的 AdventureWorks.Models 项目中导入 AdventureWorks.Models 命名空间： ****   

    ```csharp
    using AdventureWorks.Models;
    ```

1.  添加以下代码行，通过从 NuGet 导入的 Microsoft.Azure.Cosmos 包导入 Microsoft.Azure.Cosmos 和 Microsoft.Azure.Cosmos.Linq 命名空间  ：

    ```csharp
    using Microsoft.Azure.Cosmos;
    using Microsoft.Azure.Cosmos.Linq;
    ```

1.  添加以下代码行，为此文件将使用的内置命名空间添加 using 指令：

    ```csharp
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    ```

1.  输入以下代码，以添加 AdventureWorks.Context 命名空间块：

    ```csharp
    namespace AdventureWorks.Context
    {
    }
    ```

1.  在 AdventureWorks.Context 命名空间中，输入以下代码以创建新的 AdventureWorksCosmosContext 类 ：

    ```csharp
    public class AdventureWorksCosmosContext
    {
    }
    ```

1.  通过添加表示此类将实现 IAdventureWorksProductContext 接口的说明来更新 AdventureWorksCosmosContext 类的声明 ：

    ```csharp
    public class AdventureWorksCosmosContext : IAdventureWorksProductContext
    {
    }
    ```

1.  在“AdventureWorksCosmosContext”类中，输入以下代码，以创建一个名为“_container”的新的只读 Container 变量：

    ```csharp
    private readonly Container _container;
    ```

1.  在 AdventureWorksCosmosContext 类中，添加一个使用以下签名的新构造函数：

    ```csharp
    public AdventureWorksCosmosContext(string connectionString, string database = "Retail", string container = "Online")
    {
    }
    ```

1.  在构造函数中，添加以下代码块以创建 CosmosClient 类的新实例，然后从客户端获取“数据库”和“容器”实例  ：

    ```csharp
    _container = new CosmosClient(connectionString)
        .GetDatabase(database)
        .GetContainer(container);
    ```

1.  在 AdventureWorksCosmosContext 类中，添加一个使用以下签名的新 FindModelAsync 方法 ：

    ```csharp
    public async Task<Model> FindModelAsync(Guid id)
    {
    }
    ```

1.  在 FindModelAsync 方法中，添加以下代码块以创建一个 LINQ 查询，将其转换为迭代器，循环访问结果集，然后返回结果集中的单个项：

    ```csharp
    var iterator = _container.GetItemLinqQueryable<Model>()
        .Where(m => m.id == id)
        .ToFeedIterator<Model>();
    List<Model> matches = new List<Model>();
    while (iterator.HasMoreResults)
    {
        var next = await iterator.ReadNextAsync();
        matches.AddRange(next);
    }
    return matches.SingleOrDefault();
    ```

1.  在 AdventureWorksCosmosContext 类中，添加一个使用以下签名的新 GetModelsAsync 方法 ：

    ```csharp
    public async Task<List<Model>> GetModelsAsync()
    {
    }
    ```

1.  在 GetModelsAsync 方法中，添加以下代码块，以运行 SQL 查询，获取查询结果迭代器，循环访问结果集，然后返回所有结果的并集：

    ```csharp
    string query = $@"SELECT * FROM items";
    var iterator = _container.GetItemQueryIterator<Model>(query);
    List<Model> matches = new List<Model>();
    while (iterator.HasMoreResults)
    {
        var next = await iterator.ReadNextAsync();
        matches.AddRange(next);
    }
    return matches;
    ```

1.  在 AdventureWorksCosmosContext 类中，添加一个使用以下签名的新 FindProductAsync 方法 ：

    ```csharp
    public async Task<Product> FindProductAsync(Guid id)
    {
    }
    ```

1.  在 FindProductAsync 方法中，添加以下代码块，以运行 SQL 查询，获取查询结果迭代器，循环访问结果集，然后返回结果集中的单个项：

    ```csharp
    string query = $@"SELECT VALUE products
                        FROM models
                        JOIN products in models.Products
                        WHERE products.id = '{id}'";
    var iterator = _container.GetItemQueryIterator<Product>(query);
    List<Product> matches = new List<Product>();
    while (iterator.HasMoreResults)
    {
        var next = await iterator.ReadNextAsync();
        matches.AddRange(next);
    }
    return matches.SingleOrDefault();
    ```

1.  保存并关闭 AdventureWorksCosmosContext.cs 文件。 ****  
   
1.  在终端提示符下，将当前目录设置为“AdventureWorks”，运行以下命令以生成 .NET Web 应用程序：

    ```
    dotnet build
    ```

    > **注意**：如果出现任何生成错误，请查看位于 Allfiles (F):\\Allfiles\\Labs\\04\\Solution\\AdventureWorks\\AdventureWorks.Context 文件夹中的 AdventureWorksCosmosContext.cs 文件 。

#### <a name="task-3-review-the-net-application-startup-logic"></a>任务 3：查看 .NET 应用程序启动逻辑

1.  在“Visual Studio Code”窗口的“资源管理器”窗格中，展开 AdventureWorks.Web 项目。 ****   

1.  打开 Startup.cs 文件。

1.  在 Startup 类中，请注意现有的 ConfigureProductService 方法 ：

    ```csharp
    public void ConfigureProductService(IServiceCollection services)
    {
        services.AddScoped<IAdventureWorksProductContext, AdventureWorksCosmosContext>(provider =>
            new AdventureWorksCosmosContext(
                _configuration.GetConnectionString(nameof(AdventureWorksCosmosContext))
            )
        );
    }
    ```

    > **注意**：当前产品服务使用 Cosmos DB 作为其数据库。

1.  关闭 Startup.cs 文件，而不进行任何修改。 ****  

#### <a name="task-4-validate-that-the-net-application-successfully-connects-to-data-stores"></a>任务 4：验证 .NET 应用程序是否成功连接到数据存储

1.  在 Visual Studio Code 中，在终端提示符下运行以下命令，将终端上下文切换到 AdventureWorks Web 文件夹：

    ```
    cd ..\AdventureWorks.Web\
    ```

1.  在终端提示符下，运行以下命令以运行 ASP.NET Web 应用程序：

    ```
    dotnet run
    ```

    > <bpt id="p1">**</bpt>Note<ept id="p1">**</ept>: The <bpt id="p2">**</bpt>dotnet run<ept id="p2">**</ept> command will automatically build any changes to the project and then start the web application without a debugger attached. The command will output the URL of the running application and any assigned ports.

1.  在任务栏上，选择 Microsoft Edge 图标。

1.  在打开的浏览器窗口中，浏览到当前正在运行的 Web 应用程序 (<http://localhost:5000>)。

1.  在 Web 应用程序中，查看首页上显示的模型列表。

1.  找到 Touring-1000 模型，并选择“查看详细信息” 。

1.  在“Touring-1000”产品详细信息页上，查看选项列表。

1.  关闭显示 Web 应用程序的浏览器窗口。

1.  切换到“Visual Studio Code”窗口，然后选择“终止终端”（“回收站”图标）以关闭当前打开的终端和所有关联的进程  。

#### <a name="review"></a>审阅

在本练习中，你编写了 C# 代码以使用 .NET SDK 查询 Azure Cosmos DB 集合。

### <a name="exercise-4-clean-up-your-subscription"></a>练习 4：清理订阅 

#### <a name="task-1-open-azure-cloud-shell"></a>任务 1：打开 Azure Cloud Shell

1.  In the Azure portal, select the <bpt id="p1">**</bpt>Cloud Shell<ept id="p1">**</ept> icon <ph id="ph1">![</ph>Cloud Shell icon<ph id="ph2">](./media/az204_lab_CloudShell.png)</ph> to open a new Bash session. If Cloud Shell defaults to a PowerShell session, select <bpt id="p1">**</bpt>PowerShell<ept id="p1">**</ept> and, in the drop-down menu, select <bpt id="p2">**</bpt>Bash<ept id="p2">**</ept>.

     > <bpt id="p1">**</bpt>Note<ept id="p1">**</ept>: If this is the first time you're starting <bpt id="p2">**</bpt>Cloud Shell<ept id="p2">**</ept>, when prompted to select either <bpt id="p3">**</bpt>Bash<ept id="p3">**</ept> or <bpt id="p4">**</bpt>PowerShell<ept id="p4">**</ept>, select <bpt id="p5">**</bpt>PowerShell<ept id="p5">**</ept>. When you are presented with the <bpt id="p1">**</bpt>You have no storage mounted<ept id="p1">**</ept> message, select the subscription you're using in this lab, and then select <bpt id="p2">**</bpt>Create storage<ept id="p2">**</ept>.

#### <a name="task-2-delete-resource-groups"></a>任务 2：删除资源组

1.  在“Cloud Shell”窗格中，运行以下命令以删除“PolyglotData”资源组 ：

    ```
    az group delete --name PolyglotData --no-wait --yes
    ```
    
     > <bpt id="p1">**</bpt>Note<ept id="p1">**</ept>: The command executes asynchronously (as determined by the <bpt id="p2">*</bpt>--no-wait<ept id="p2">*</ept> parameter). Therefore, while you'll be able to run another Azure CLI command immediately after, within the same Bash session, it'll take a few minutes before the resource groups are actually removed.
  
1.  关闭门户中的“Cloud Shell”窗格。

#### <a name="task-3-close-the-active-applications"></a>任务 3：关闭活动应用程序

1.  关闭当前正在运行的 Microsoft Edge 应用程序。

1.  关闭当前正在运行的“Visual Studio Code”应用程序。

#### <a name="review"></a>审阅

在本练习中，你通过删除本实验室中使用的资源组清理了订阅。
